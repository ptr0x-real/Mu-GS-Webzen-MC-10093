; Listing generated by Microsoft (R) Optimizing Compiler Version 19.27.29111.0 

	TITLE	C:\Mu Online\Mu-GS-Webzen-MC-10093\GameServer\PShop.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?__empty_global_delete@@YAXPAX@Z		; __empty_global_delete
PUBLIC	?__empty_global_delete@@YAXPAXI@Z		; __empty_global_delete
PUBLIC	___local_stdio_printf_options
PUBLIC	__vfprintf_l
PUBLIC	_fprintf
PUBLIC	?CGPShopReqBuyItemTest@CPShop@@SAXPAUPMSG_REQ_BUYITEM_FROM_PSHOP@@H@Z ; CPShop::CGPShopReqBuyItemTest
PUBLIC	?CustomLogcash@CPShop@@SAXPAD@Z			; CPShop::CustomLogcash
PUBLIC	?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA ; `__local_stdio_printf_options'::`2'::_OptionsStorage
PUBLIC	??_C@_0DH@KMOFMONM@?$FLCOMPRA?$FN?5Cuenta?3?$FL?$CFs?$FN?5Usuario?3?$FL?$CF@ ; `string'
PUBLIC	??_C@_0CF@OCIKLGKC@BOTSTORE?2?$CF02d_?$CF02d_?$CF02d_cash_Lo@ ; `string'
PUBLIC	??_C@_02DPNLHKJD@a?$CL@				; `string'
PUBLIC	??_C@_0BF@GGGMCMIJ@?$CF02d?3?$CF02d?3?$CF02d?5?9?5?$CFs?6@ ; `string'
EXTRN	___report_rangecheckfailure:PROC
EXTRN	_memcpy:PROC
EXTRN	_memset:PROC
EXTRN	__imp__GetLocalTime@4:PROC
EXTRN	__imp__wsprintfA:PROC
EXTRN	_fclose:PROC
EXTRN	_fopen:PROC
EXTRN	___stdio_common_vfprintf:PROC
EXTRN	?gObjIsConnected@@YAHH@Z:PROC			; gObjIsConnected
EXTRN	?PShop_CheckInventoryEmpty@@YA_NF@Z:PROC	; PShop_CheckInventoryEmpty
EXTRN	?CGPShopAnsBuyItem@@YAXHHHE@Z:PROC		; CGPShopAnsBuyItem
EXTRN	?CGPShopAnsClose@@YAXHE@Z:PROC			; CGPShopAnsClose
EXTRN	?KCredits@CManager@@QAEHPAD@Z:PROC		; CManager::KCredits
EXTRN	?Pshopnpc@CManager@@QAEHPAD@Z:PROC		; CManager::Pshopnpc
EXTRN	@__security_check_cookie@4:PROC
EXTRN	_memset:PROC
EXTRN	?gObj@@3PAVOBJECTSTRUCT@@A:DWORD		; gObj
EXTRN	?Manager@@3VCManager@@A:BYTE			; Manager
EXTRN	___security_cookie:DWORD
;	COMDAT ?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA
_BSS	SEGMENT
?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA DQ 01H DUP (?) ; `__local_stdio_printf_options'::`2'::_OptionsStorage
_BSS	ENDS
;	COMDAT ??_C@_0BF@GGGMCMIJ@?$CF02d?3?$CF02d?3?$CF02d?5?9?5?$CFs?6@
CONST	SEGMENT
??_C@_0BF@GGGMCMIJ@?$CF02d?3?$CF02d?3?$CF02d?5?9?5?$CFs?6@ DB '%02d:%02d:'
	DB	'%02d - %s', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_02DPNLHKJD@a?$CL@
CONST	SEGMENT
??_C@_02DPNLHKJD@a?$CL@ DB 'a+', 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0CF@OCIKLGKC@BOTSTORE?2?$CF02d_?$CF02d_?$CF02d_cash_Lo@
CONST	SEGMENT
??_C@_0CF@OCIKLGKC@BOTSTORE?2?$CF02d_?$CF02d_?$CF02d_cash_Lo@ DB 'BOTSTOR'
	DB	'E\%02d_%02d_%02d_cash_Log.txt', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0DH@KMOFMONM@?$FLCOMPRA?$FN?5Cuenta?3?$FL?$CFs?$FN?5Usuario?3?$FL?$CF@
CONST	SEGMENT
??_C@_0DH@KMOFMONM@?$FLCOMPRA?$FN?5Cuenta?3?$FL?$CFs?$FN?5Usuario?3?$FL?$CF@ DB '['
	DB	'COMPRA] Cuenta:[%s] Usuario:[%s] Compro por [%d] Cash', 00H ; `string'
CONST	ENDS
; Function compile flags: /Odtp /ZI
; File C:\Mu Online\Mu-GS-Webzen-MC-10093\GameServer\PShop.cpp
;	COMDAT ?CustomLogcash@CPShop@@SAXPAD@Z
_TEXT	SEGMENT
_logString$ = -1048					; size = 512
_stream$ = -536						; size = 4
_now$ = -20						; size = 16
__$ArrayPad$ = -4					; size = 4
_Text$ = 8						; size = 4
?CustomLogcash@CPShop@@SAXPAD@Z PROC			; CPShop::CustomLogcash, COMDAT

; 136  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	81 ec d8 04 00
	00		 sub	 esp, 1240		; 000004d8H
  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  0000e	33 c5		 xor	 eax, ebp
  00010	89 45 fc	 mov	 DWORD PTR __$ArrayPad$[ebp], eax
  00013	53		 push	 ebx
  00014	56		 push	 esi
  00015	57		 push	 edi

; 137  : 	SYSTEMTIME now;
; 138  : 	GetLocalTime(&now);

  00016	8d 45 ec	 lea	 eax, DWORD PTR _now$[ebp]
  00019	50		 push	 eax
  0001a	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetLocalTime@4

; 139  : 
; 140  : 	TCHAR LogTexto[512];
; 141  : 	FILE *stream;
; 142  : 
; 143  : 	TCHAR logString[512];
; 144  : 
; 145  : 	wsprintf(logString, "BOTSTORE\\%02d_%02d_%02d_cash_Log.txt", now.wYear, now.wMonth, now.wDay);

  00020	0f b7 45 f2	 movzx	 eax, WORD PTR _now$[ebp+6]
  00024	50		 push	 eax
  00025	0f b7 4d ee	 movzx	 ecx, WORD PTR _now$[ebp+2]
  00029	51		 push	 ecx
  0002a	0f b7 55 ec	 movzx	 edx, WORD PTR _now$[ebp]
  0002e	52		 push	 edx
  0002f	68 00 00 00 00	 push	 OFFSET ??_C@_0CF@OCIKLGKC@BOTSTORE?2?$CF02d_?$CF02d_?$CF02d_cash_Lo@
  00034	8d 85 e8 fb ff
	ff		 lea	 eax, DWORD PTR _logString$[ebp]
  0003a	50		 push	 eax
  0003b	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__wsprintfA
  00041	83 c4 14	 add	 esp, 20			; 00000014H

; 146  : 	stream = fopen(logString, "a+");

  00044	68 00 00 00 00	 push	 OFFSET ??_C@_02DPNLHKJD@a?$CL@
  00049	8d 85 e8 fb ff
	ff		 lea	 eax, DWORD PTR _logString$[ebp]
  0004f	50		 push	 eax
  00050	e8 00 00 00 00	 call	 _fopen
  00055	83 c4 08	 add	 esp, 8
  00058	89 85 e8 fd ff
	ff		 mov	 DWORD PTR _stream$[ebp], eax

; 147  : 	fprintf(stream, "%02d:%02d:%02d - %s\n", now.wHour, now.wMinute, now.wSecond, Text);

  0005e	8b 45 08	 mov	 eax, DWORD PTR _Text$[ebp]
  00061	50		 push	 eax
  00062	0f b7 4d f8	 movzx	 ecx, WORD PTR _now$[ebp+12]
  00066	51		 push	 ecx
  00067	0f b7 55 f6	 movzx	 edx, WORD PTR _now$[ebp+10]
  0006b	52		 push	 edx
  0006c	0f b7 45 f4	 movzx	 eax, WORD PTR _now$[ebp+8]
  00070	50		 push	 eax
  00071	68 00 00 00 00	 push	 OFFSET ??_C@_0BF@GGGMCMIJ@?$CF02d?3?$CF02d?3?$CF02d?5?9?5?$CFs?6@
  00076	8b 8d e8 fd ff
	ff		 mov	 ecx, DWORD PTR _stream$[ebp]
  0007c	51		 push	 ecx
  0007d	e8 00 00 00 00	 call	 _fprintf
  00082	83 c4 18	 add	 esp, 24			; 00000018H

; 148  : 	fclose(stream);

  00085	8b 85 e8 fd ff
	ff		 mov	 eax, DWORD PTR _stream$[ebp]
  0008b	50		 push	 eax
  0008c	e8 00 00 00 00	 call	 _fclose
  00091	83 c4 04	 add	 esp, 4

; 149  : }

  00094	5f		 pop	 edi
  00095	5e		 pop	 esi
  00096	5b		 pop	 ebx
  00097	8b 4d fc	 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  0009a	33 cd		 xor	 ecx, ebp
  0009c	e8 00 00 00 00	 call	 @__security_check_cookie@4
  000a1	8b e5		 mov	 esp, ebp
  000a3	5d		 pop	 ebp
  000a4	c3		 ret	 0
?CustomLogcash@CPShop@@SAXPAD@Z ENDP			; CPShop::CustomLogcash
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File C:\Mu Online\Mu-GS-Webzen-MC-10093\GameServer\PShop.cpp
;	COMDAT ?CGPShopReqBuyItemTest@CPShop@@SAXPAUPMSG_REQ_BUYITEM_FROM_PSHOP@@H@Z
_TEXT	SEGMENT
$T1 = -372						; size = 4
_CashLog$2 = -304					; size = 255
_precio$3 = -48						; size = 4
_iITEM_LOG_SERIAL$ = -44				; size = 4
_iITEM_LOG_DUR$ = -40					; size = 4
_iITEM_LOG_LEVEL$ = -36					; size = 4
_iITEM_LOG_TYPE$ = -32					; size = 4
_szName$ = -28						; size = 11
_Golds$ = -16						; size = 4
_NPCGOLDS$ = -12					; size = 4
_lpObj$ = -8						; size = 4
__$ArrayPad$ = -4					; size = 4
_lpMsg$ = 8						; size = 4
_aSourceIndex$ = 12					; size = 4
?CGPShopReqBuyItemTest@CPShop@@SAXPAUPMSG_REQ_BUYITEM_FROM_PSHOP@@H@Z PROC ; CPShop::CGPShopReqBuyItemTest, COMDAT

; 53   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	81 ec 74 01 00
	00		 sub	 esp, 372		; 00000174H
  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  0000e	33 c5		 xor	 eax, ebp
  00010	89 45 fc	 mov	 DWORD PTR __$ArrayPad$[ebp], eax
  00013	53		 push	 ebx
  00014	56		 push	 esi
  00015	57		 push	 edi

; 54   : 	LPOBJECTSTRUCT lpObj = &gObj[MAKE_NUMBERW(lpMsg->NumberH, lpMsg->NumberL)];

  00016	8b 45 08	 mov	 eax, DWORD PTR _lpMsg$[ebp]
  00019	0f b6 48 05	 movzx	 ecx, BYTE PTR [eax+5]
  0001d	81 e1 ff 00 00
	00		 and	 ecx, 255		; 000000ffH
  00023	0f b6 d1	 movzx	 edx, cl
  00026	8b 45 08	 mov	 eax, DWORD PTR _lpMsg$[ebp]
  00029	0f b6 48 04	 movzx	 ecx, BYTE PTR [eax+4]
  0002d	81 e1 ff 00 00
	00		 and	 ecx, 255		; 000000ffH
  00033	0f b6 c1	 movzx	 eax, cl
  00036	c1 e0 08	 shl	 eax, 8
  00039	0b d0		 or	 edx, eax
  0003b	0f b7 ca	 movzx	 ecx, dx
  0003e	69 d1 a0 1b 00
	00		 imul	 edx, ecx, 7072
  00044	03 15 00 00 00
	00		 add	 edx, DWORD PTR ?gObj@@3PAVOBJECTSTRUCT@@A ; gObj
  0004a	89 55 f8	 mov	 DWORD PTR _lpObj$[ebp], edx

; 55   : 
; 56   : 	int NPCGOLDS = Manager.Pshopnpc(lpObj->AccountID);

  0004d	8b 45 f8	 mov	 eax, DWORD PTR _lpObj$[ebp]
  00050	83 c0 68	 add	 eax, 104		; 00000068H
  00053	50		 push	 eax
  00054	b9 00 00 00 00	 mov	 ecx, OFFSET ?Manager@@3VCManager@@A ; Manager
  00059	e8 00 00 00 00	 call	 ?Pshopnpc@CManager@@QAEHPAD@Z ; CManager::Pshopnpc
  0005e	89 45 f4	 mov	 DWORD PTR _NPCGOLDS$[ebp], eax

; 57   : 	int Golds = Manager.KCredits(gObj[aSourceIndex].AccountID);

  00061	69 45 0c a0 1b
	00 00		 imul	 eax, DWORD PTR _aSourceIndex$[ebp], 7072
  00068	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?gObj@@3PAVOBJECTSTRUCT@@A ; gObj
  0006e	8d 54 01 68	 lea	 edx, DWORD PTR [ecx+eax+104]
  00072	52		 push	 edx
  00073	b9 00 00 00 00	 mov	 ecx, OFFSET ?Manager@@3VCManager@@A ; Manager
  00078	e8 00 00 00 00	 call	 ?KCredits@CManager@@QAEHPAD@Z ; CManager::KCredits
  0007d	89 45 f0	 mov	 DWORD PTR _Golds$[ebp], eax

; 58   : 	//GetPrivateProfileString("UPDATE OFFTRADE", "OFFTRADEOFF", "UPDATE MuOnline.dbo.MEMB_INFO SET OfftradeOn = +1 WHERE memb___id = '%s'", g_GlobalConfig.OfftradeOff, 200, CFG_QUERYSHOP);//SACA GOLDS
; 59   : 	
; 60   : 	if (gObjIsConnected(MAKE_NUMBERW(lpMsg->NumberH, lpMsg->NumberL)) == FALSE)

  00080	8b 45 08	 mov	 eax, DWORD PTR _lpMsg$[ebp]
  00083	0f b6 48 05	 movzx	 ecx, BYTE PTR [eax+5]
  00087	81 e1 ff 00 00
	00		 and	 ecx, 255		; 000000ffH
  0008d	0f b6 d1	 movzx	 edx, cl
  00090	8b 45 08	 mov	 eax, DWORD PTR _lpMsg$[ebp]
  00093	0f b6 48 04	 movzx	 ecx, BYTE PTR [eax+4]
  00097	81 e1 ff 00 00
	00		 and	 ecx, 255		; 000000ffH
  0009d	0f b6 c1	 movzx	 eax, cl
  000a0	c1 e0 08	 shl	 eax, 8
  000a3	0b d0		 or	 edx, eax
  000a5	0f b7 ca	 movzx	 ecx, dx
  000a8	51		 push	 ecx
  000a9	e8 00 00 00 00	 call	 ?gObjIsConnected@@YAHH@Z ; gObjIsConnected
  000ae	83 c4 04	 add	 esp, 4
  000b1	85 c0		 test	 eax, eax
  000b3	75 17		 jne	 SHORT $LN2@CGPShopReq

; 61   : 	{
; 62   : 		//Log.Inform("[PShop] [%s][%s] PShop Item Buy Request Failed : Seller did Not CONNECTED (%d)", gObj[aSourceIndex].AccountID, gObj[aSourceIndex].Name, MAKE_NUMBERW(lpMsg->NumberH, lpMsg->NumberL));
; 63   : 		CGPShopAnsBuyItem(aSourceIndex, -1, 0, 2);

  000b5	6a 02		 push	 2
  000b7	6a 00		 push	 0
  000b9	6a ff		 push	 -1
  000bb	8b 45 0c	 mov	 eax, DWORD PTR _aSourceIndex$[ebp]
  000be	50		 push	 eax
  000bf	e8 00 00 00 00	 call	 ?CGPShopAnsBuyItem@@YAXHHHE@Z ; CGPShopAnsBuyItem
  000c4	83 c4 10	 add	 esp, 16			; 00000010H

; 64   : 		return;

  000c7	e9 6c 02 00 00	 jmp	 $LN1@CGPShopReq
$LN2@CGPShopReq:

; 65   : 	}
; 66   : 
; 67   : 	if (lpObj->Type != OBJTYPE_CHARACTER)

  000cc	8b 45 f8	 mov	 eax, DWORD PTR _lpObj$[ebp]
  000cf	0f b7 48 64	 movzx	 ecx, WORD PTR [eax+100]
  000d3	83 f9 01	 cmp	 ecx, 1
  000d6	74 17		 je	 SHORT $LN3@CGPShopReq

; 68   : 	{
; 69   : 		//Log.Inform("[PShop] [%s][%s] PShop Item Buy Request Failed : Seller is Not CHARACTER (%d)", gObj[aSourceIndex].AccountID, gObj[aSourceIndex].Name, MAKE_NUMBERW(lpMsg->NumberH, lpMsg->NumberL));
; 70   : 		CGPShopAnsBuyItem(aSourceIndex, -1, 0, 2);

  000d8	6a 02		 push	 2
  000da	6a 00		 push	 0
  000dc	6a ff		 push	 -1
  000de	8b 45 0c	 mov	 eax, DWORD PTR _aSourceIndex$[ebp]
  000e1	50		 push	 eax
  000e2	e8 00 00 00 00	 call	 ?CGPShopAnsBuyItem@@YAXHHHE@Z ; CGPShopAnsBuyItem
  000e7	83 c4 10	 add	 esp, 16			; 00000010H

; 71   : 		return;

  000ea	e9 49 02 00 00	 jmp	 $LN1@CGPShopReq
$LN3@CGPShopReq:

; 72   : 	}
; 73   : 
; 74   : 	if (lpObj->CloseCount >= 0)

  000ef	8b 45 f8	 mov	 eax, DWORD PTR _lpObj$[ebp]
  000f2	0f be 48 0a	 movsx	 ecx, BYTE PTR [eax+10]
  000f6	85 c9		 test	 ecx, ecx
  000f8	7c 17		 jl	 SHORT $LN4@CGPShopReq

; 75   : 	{
; 76   : 		//Log.Inform("[PShop] [%s][%s] PShop Item Buy Request Failed : Seller is Closing (%d)", gObj[aSourceIndex].AccountID, gObj[aSourceIndex].Name, MAKE_NUMBERW(lpMsg->NumberH, lpMsg->NumberL));
; 77   : 		CGPShopAnsBuyItem(aSourceIndex, -1, 0, 2);

  000fa	6a 02		 push	 2
  000fc	6a 00		 push	 0
  000fe	6a ff		 push	 -1
  00100	8b 45 0c	 mov	 eax, DWORD PTR _aSourceIndex$[ebp]
  00103	50		 push	 eax
  00104	e8 00 00 00 00	 call	 ?CGPShopAnsBuyItem@@YAXHHHE@Z ; CGPShopAnsBuyItem
  00109	83 c4 10	 add	 esp, 16			; 00000010H

; 78   : 		return;

  0010c	e9 27 02 00 00	 jmp	 $LN1@CGPShopReq
$LN4@CGPShopReq:

; 79   : 	}
; 80   : 
; 81   : 	if (gObj[aSourceIndex].CloseCount >= 0)

  00111	69 45 0c a0 1b
	00 00		 imul	 eax, DWORD PTR _aSourceIndex$[ebp], 7072
  00118	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?gObj@@3PAVOBJECTSTRUCT@@A ; gObj
  0011e	0f be 54 01 0a	 movsx	 edx, BYTE PTR [ecx+eax+10]
  00123	85 d2		 test	 edx, edx
  00125	7c 17		 jl	 SHORT $LN5@CGPShopReq

; 82   : 	{
; 83   : 		//Log.Inform("[PShop] [%s][%s] PShop Item Buy Request Failed : Buyer is Closing (%d)", gObj[aSourceIndex].AccountID, gObj[aSourceIndex].Name, MAKE_NUMBERW(lpMsg->NumberH, lpMsg->NumberL));
; 84   : 		CGPShopAnsBuyItem(aSourceIndex, -1, 0, 2);

  00127	6a 02		 push	 2
  00129	6a 00		 push	 0
  0012b	6a ff		 push	 -1
  0012d	8b 45 0c	 mov	 eax, DWORD PTR _aSourceIndex$[ebp]
  00130	50		 push	 eax
  00131	e8 00 00 00 00	 call	 ?CGPShopAnsBuyItem@@YAXHHHE@Z ; CGPShopAnsBuyItem
  00136	83 c4 10	 add	 esp, 16			; 00000010H

; 85   : 		return;

  00139	e9 fa 01 00 00	 jmp	 $LN1@CGPShopReq
$LN5@CGPShopReq:

; 86   : 	}
; 87   : 
; 88   : 	if (lpObj->m_bPShopOpen == false)

  0013e	8b 45 f8	 mov	 eax, DWORD PTR _lpObj$[ebp]
  00141	0f b6 88 f8 0c
	00 00		 movzx	 ecx, BYTE PTR [eax+3320]
  00148	85 c9		 test	 ecx, ecx
  0014a	75 17		 jne	 SHORT $LN6@CGPShopReq

; 89   : 	{
; 90   : 		//Log.Inform("[PShop] [%s][%s] PShop Item Buy Request Failed : [%s][%s] Did not Open PShop", gObj[aSourceIndex].AccountID, gObj[aSourceIndex].Name, lpObj->AccountID, lpObj->Name);
; 91   : 		CGPShopAnsBuyItem(aSourceIndex, -1, 0, 2);

  0014c	6a 02		 push	 2
  0014e	6a 00		 push	 0
  00150	6a ff		 push	 -1
  00152	8b 45 0c	 mov	 eax, DWORD PTR _aSourceIndex$[ebp]
  00155	50		 push	 eax
  00156	e8 00 00 00 00	 call	 ?CGPShopAnsBuyItem@@YAXHHHE@Z ; CGPShopAnsBuyItem
  0015b	83 c4 10	 add	 esp, 16			; 00000010H

; 92   : 		return;

  0015e	e9 d5 01 00 00	 jmp	 $LN1@CGPShopReq
$LN6@CGPShopReq:

; 93   : 	}
; 94   : 	
; 95   : 	char szName[MAX_ACCOUNT_LEN + 1] = { 0 };

  00163	33 c0		 xor	 eax, eax
  00165	89 45 e4	 mov	 DWORD PTR _szName$[ebp], eax
  00168	89 45 e8	 mov	 DWORD PTR _szName$[ebp+4], eax
  0016b	66 89 45 ec	 mov	 WORD PTR _szName$[ebp+8], ax
  0016f	88 45 ee	 mov	 BYTE PTR _szName$[ebp+10], al

; 96   : 	memcpy(szName, lpMsg->btName, sizeof(lpMsg->btName));

  00172	6a 0a		 push	 10			; 0000000aH
  00174	8b 45 08	 mov	 eax, DWORD PTR _lpMsg$[ebp]
  00177	83 c0 06	 add	 eax, 6
  0017a	50		 push	 eax
  0017b	8d 4d e4	 lea	 ecx, DWORD PTR _szName$[ebp]
  0017e	51		 push	 ecx
  0017f	e8 00 00 00 00	 call	 _memcpy
  00184	83 c4 0c	 add	 esp, 12			; 0000000cH

; 97   : 	szName[MAX_ACCOUNT_LEN] = 0;

  00187	b8 01 00 00 00	 mov	 eax, 1
  0018c	6b c8 0a	 imul	 ecx, eax, 10
  0018f	89 8d 8c fe ff
	ff		 mov	 DWORD PTR $T1[ebp], ecx
  00195	83 bd 8c fe ff
	ff 0b		 cmp	 DWORD PTR $T1[ebp], 11	; 0000000bH
  0019c	73 02		 jae	 SHORT $LN11@CGPShopReq
  0019e	eb 05		 jmp	 SHORT $LN12@CGPShopReq
$LN11@CGPShopReq:
  001a0	e8 00 00 00 00	 call	 ___report_rangecheckfailure
$LN12@CGPShopReq:
  001a5	8b 95 8c fe ff
	ff		 mov	 edx, DWORD PTR $T1[ebp]
  001ab	c6 44 15 e4 00	 mov	 BYTE PTR _szName$[ebp+edx], 0

; 98   : 	int iITEM_LOG_TYPE;
; 99   : 	int iITEM_LOG_LEVEL;
; 100  : 	int iITEM_LOG_DUR;
; 101  : 	int iITEM_LOG_SERIAL;
; 102  : 
; 103  : 	if (NPCGOLDS == 1)

  001b0	83 7d f4 01	 cmp	 DWORD PTR _NPCGOLDS$[ebp], 1
  001b4	0f 85 22 01 00
	00		 jne	 $LN7@CGPShopReq

; 104  : 	{
; 105  : 		iITEM_LOG_TYPE = gObj[aSourceIndex].Inventory1[lpMsg->btItemPos].m_Type;

  001ba	69 45 0c a0 1b
	00 00		 imul	 eax, DWORD PTR _aSourceIndex$[ebp], 7072
  001c1	8b 4d 08	 mov	 ecx, DWORD PTR _lpMsg$[ebp]
  001c4	0f b6 51 10	 movzx	 edx, BYTE PTR [ecx+16]
  001c8	69 ca a8 00 00
	00		 imul	 ecx, edx, 168
  001ce	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?gObj@@3PAVOBJECTSTRUCT@@A ; gObj
  001d4	8b 84 02 6c 0c
	00 00		 mov	 eax, DWORD PTR [edx+eax+3180]
  001db	0f bf 4c 08 06	 movsx	 ecx, WORD PTR [eax+ecx+6]
  001e0	89 4d e0	 mov	 DWORD PTR _iITEM_LOG_TYPE$[ebp], ecx

; 106  : 		iITEM_LOG_LEVEL = gObj[aSourceIndex].Inventory1[lpMsg->btItemPos].m_Level;

  001e3	69 45 0c a0 1b
	00 00		 imul	 eax, DWORD PTR _aSourceIndex$[ebp], 7072
  001ea	8b 4d 08	 mov	 ecx, DWORD PTR _lpMsg$[ebp]
  001ed	0f b6 51 10	 movzx	 edx, BYTE PTR [ecx+16]
  001f1	69 ca a8 00 00
	00		 imul	 ecx, edx, 168
  001f7	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?gObj@@3PAVOBJECTSTRUCT@@A ; gObj
  001fd	8b 84 02 6c 0c
	00 00		 mov	 eax, DWORD PTR [edx+eax+3180]
  00204	0f bf 4c 08 08	 movsx	 ecx, WORD PTR [eax+ecx+8]
  00209	89 4d dc	 mov	 DWORD PTR _iITEM_LOG_LEVEL$[ebp], ecx

; 107  : 		iITEM_LOG_DUR = gObj[aSourceIndex].Inventory1[lpMsg->btItemPos].m_Durability;

  0020c	69 45 0c a0 1b
	00 00		 imul	 eax, DWORD PTR _aSourceIndex$[ebp], 7072
  00213	8b 4d 08	 mov	 ecx, DWORD PTR _lpMsg$[ebp]
  00216	0f b6 51 10	 movzx	 edx, BYTE PTR [ecx+16]
  0021a	69 ca a8 00 00
	00		 imul	 ecx, edx, 168
  00220	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?gObj@@3PAVOBJECTSTRUCT@@A ; gObj
  00226	8b 84 02 6c 0c
	00 00		 mov	 eax, DWORD PTR [edx+eax+3180]
  0022d	f3 0f 2c 4c 08
	24		 cvttss2si ecx, DWORD PTR [eax+ecx+36]
  00233	89 4d d8	 mov	 DWORD PTR _iITEM_LOG_DUR$[ebp], ecx

; 108  : 		iITEM_LOG_SERIAL = gObj[aSourceIndex].Inventory1[lpMsg->btItemPos].m_Number;

  00236	69 45 0c a0 1b
	00 00		 imul	 eax, DWORD PTR _aSourceIndex$[ebp], 7072
  0023d	8b 4d 08	 mov	 ecx, DWORD PTR _lpMsg$[ebp]
  00240	0f b6 51 10	 movzx	 edx, BYTE PTR [ecx+16]
  00244	69 ca a8 00 00
	00		 imul	 ecx, edx, 168
  0024a	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?gObj@@3PAVOBJECTSTRUCT@@A ; gObj
  00250	8b 84 02 6c 0c
	00 00		 mov	 eax, DWORD PTR [edx+eax+3180]
  00257	8b 0c 08	 mov	 ecx, DWORD PTR [eax+ecx]
  0025a	89 4d d4	 mov	 DWORD PTR _iITEM_LOG_SERIAL$[ebp], ecx

; 109  : 		int precio = lpObj->Inventory1[lpMsg->btItemPos].m_iPShopValue;

  0025d	8b 45 08	 mov	 eax, DWORD PTR _lpMsg$[ebp]
  00260	0f b6 48 10	 movzx	 ecx, BYTE PTR [eax+16]
  00264	69 d1 a8 00 00
	00		 imul	 edx, ecx, 168
  0026a	8b 45 f8	 mov	 eax, DWORD PTR _lpObj$[ebp]
  0026d	8b 88 6c 0c 00
	00		 mov	 ecx, DWORD PTR [eax+3180]
  00273	8b 54 11 68	 mov	 edx, DWORD PTR [ecx+edx+104]
  00277	89 55 d0	 mov	 DWORD PTR _precio$3[ebp], edx

; 110  : 		SQLCHAR CashLog[255] = { 0 };

  0027a	68 ff 00 00 00	 push	 255			; 000000ffH
  0027f	6a 00		 push	 0
  00281	8d 85 d0 fe ff
	ff		 lea	 eax, DWORD PTR _CashLog$2[ebp]
  00287	50		 push	 eax
  00288	e8 00 00 00 00	 call	 _memset
  0028d	83 c4 0c	 add	 esp, 12			; 0000000cH

; 111  : 		wsprintf((char *)CashLog, "[COMPRA] Cuenta:[%s] Usuario:[%s] Compro por [%d] Cash", gObj[aSourceIndex].AccountID, gObj[aSourceIndex].Name, precio);//GUARDA LOGS DEL CAMBIO DE GOLDS

  00290	8b 45 d0	 mov	 eax, DWORD PTR _precio$3[ebp]
  00293	50		 push	 eax
  00294	69 4d 0c a0 1b
	00 00		 imul	 ecx, DWORD PTR _aSourceIndex$[ebp], 7072
  0029b	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?gObj@@3PAVOBJECTSTRUCT@@A ; gObj
  002a1	8d 44 0a 73	 lea	 eax, DWORD PTR [edx+ecx+115]
  002a5	50		 push	 eax
  002a6	69 4d 0c a0 1b
	00 00		 imul	 ecx, DWORD PTR _aSourceIndex$[ebp], 7072
  002ad	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?gObj@@3PAVOBJECTSTRUCT@@A ; gObj
  002b3	8d 44 0a 68	 lea	 eax, DWORD PTR [edx+ecx+104]
  002b7	50		 push	 eax
  002b8	68 00 00 00 00	 push	 OFFSET ??_C@_0DH@KMOFMONM@?$FLCOMPRA?$FN?5Cuenta?3?$FL?$CFs?$FN?5Usuario?3?$FL?$CF@
  002bd	8d 8d d0 fe ff
	ff		 lea	 ecx, DWORD PTR _CashLog$2[ebp]
  002c3	51		 push	 ecx
  002c4	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__wsprintfA
  002ca	83 c4 14	 add	 esp, 20			; 00000014H

; 112  : 		CPShop::CustomLogcash((char*)CashLog);//GUARDA LOGS DEL CAMBIO DE GOLDS

  002cd	8d 85 d0 fe ff
	ff		 lea	 eax, DWORD PTR _CashLog$2[ebp]
  002d3	50		 push	 eax
  002d4	e8 00 00 00 00	 call	 ?CustomLogcash@CPShop@@SAXPAD@Z ; CPShop::CustomLogcash
  002d9	83 c4 04	 add	 esp, 4
$LN7@CGPShopReq:

; 113  : 	   // Log.Inform("[COMPRA] Cuenta:[%s] Usuario : [%s] Compro por [%d] Cash", gObj[aSourceIndex].AccountID, gObj[aSourceIndex].Name, precio);//GUARDA LOGS DEL CAMBIO DE GOLDS	
; 114  : 	}
; 115  : 
; 116  : 	if (PShop_CheckInventoryEmpty(lpObj->m_Index) == true) // era ==

  002dc	8b 45 f8	 mov	 eax, DWORD PTR _lpObj$[ebp]
  002df	0f b7 08	 movzx	 ecx, WORD PTR [eax]
  002e2	51		 push	 ecx
  002e3	e8 00 00 00 00	 call	 ?PShop_CheckInventoryEmpty@@YA_NF@Z ; PShop_CheckInventoryEmpty
  002e8	83 c4 04	 add	 esp, 4
  002eb	0f b6 d0	 movzx	 edx, al
  002ee	83 fa 01	 cmp	 edx, 1
  002f1	75 31		 jne	 SHORT $LN8@CGPShopReq

; 117  : 	{
; 118  : 
; 119  : 		lpObj->m_bPShopOpen = false;

  002f3	8b 45 f8	 mov	 eax, DWORD PTR _lpObj$[ebp]
  002f6	c6 80 f8 0c 00
	00 00		 mov	 BYTE PTR [eax+3320], 0

; 120  : 		memset(lpObj->m_szPShopText, 0, sizeof(lpObj->m_szPShopText));

  002fd	6a 24		 push	 36			; 00000024H
  002ff	6a 00		 push	 0
  00301	8b 45 f8	 mov	 eax, DWORD PTR _lpObj$[ebp]
  00304	05 fc 0c 00 00	 add	 eax, 3324		; 00000cfcH
  00309	50		 push	 eax
  0030a	e8 00 00 00 00	 call	 _memset
  0030f	83 c4 0c	 add	 esp, 12			; 0000000cH

; 121  : 		CGPShopAnsClose(lpObj->m_Index, 1);

  00312	6a 01		 push	 1
  00314	8b 45 f8	 mov	 eax, DWORD PTR _lpObj$[ebp]
  00317	8b 08		 mov	 ecx, DWORD PTR [eax]
  00319	51		 push	 ecx
  0031a	e8 00 00 00 00	 call	 ?CGPShopAnsClose@@YAXHE@Z ; CGPShopAnsClose
  0031f	83 c4 08	 add	 esp, 8

; 122  : 
; 123  : 	}

  00322	eb 0a		 jmp	 SHORT $LN9@CGPShopReq
$LN8@CGPShopReq:

; 124  : 	else
; 125  : 	{
; 126  : 		lpObj->m_bPShopItemChange = true;

  00324	8b 45 f8	 mov	 eax, DWORD PTR _lpObj$[ebp]
  00327	c6 80 fa 0c 00
	00 01		 mov	 BYTE PTR [eax+3322], 1
$LN9@CGPShopReq:

; 127  : 	}
; 128  : 
; 129  : 
; 130  : 	lpObj->m_bPShopTransaction = false;

  0032e	8b 45 f8	 mov	 eax, DWORD PTR _lpObj$[ebp]
  00331	c6 80 f9 0c 00
	00 00		 mov	 BYTE PTR [eax+3321], 0
$LN1@CGPShopReq:

; 131  : 
; 132  : 	}

  00338	5f		 pop	 edi
  00339	5e		 pop	 esi
  0033a	5b		 pop	 ebx
  0033b	8b 4d fc	 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  0033e	33 cd		 xor	 ecx, ebp
  00340	e8 00 00 00 00	 call	 @__security_check_cookie@4
  00345	8b e5		 mov	 esp, ebp
  00347	5d		 pop	 ebp
  00348	c3		 ret	 0
?CGPShopReqBuyItemTest@CPShop@@SAXPAUPMSG_REQ_BUYITEM_FROM_PSHOP@@H@Z ENDP ; CPShop::CGPShopReqBuyItemTest
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt\stdio.h
;	COMDAT _fprintf
_TEXT	SEGMENT
__ArgList$ = -8						; size = 4
__Result$ = -4						; size = 4
__Stream$ = 8						; size = 4
__Format$ = 12						; size = 4
_fprintf PROC						; COMDAT

; 835  :     {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 4c	 sub	 esp, 76			; 0000004cH
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 836  :         int _Result;
; 837  :         va_list _ArgList;
; 838  :         __crt_va_start(_ArgList, _Format);

  00009	8d 45 10	 lea	 eax, DWORD PTR __Format$[ebp+4]
  0000c	89 45 f8	 mov	 DWORD PTR __ArgList$[ebp], eax

; 839  :         _Result = _vfprintf_l(_Stream, _Format, NULL, _ArgList);

  0000f	8b 45 f8	 mov	 eax, DWORD PTR __ArgList$[ebp]
  00012	50		 push	 eax
  00013	6a 00		 push	 0
  00015	8b 4d 0c	 mov	 ecx, DWORD PTR __Format$[ebp]
  00018	51		 push	 ecx
  00019	8b 55 08	 mov	 edx, DWORD PTR __Stream$[ebp]
  0001c	52		 push	 edx
  0001d	e8 00 00 00 00	 call	 __vfprintf_l
  00022	83 c4 10	 add	 esp, 16			; 00000010H
  00025	89 45 fc	 mov	 DWORD PTR __Result$[ebp], eax

; 840  :         __crt_va_end(_ArgList);

  00028	c7 45 f8 00 00
	00 00		 mov	 DWORD PTR __ArgList$[ebp], 0

; 841  :         return _Result;

  0002f	8b 45 fc	 mov	 eax, DWORD PTR __Result$[ebp]

; 842  :     }

  00032	5f		 pop	 edi
  00033	5e		 pop	 esi
  00034	5b		 pop	 ebx
  00035	8b e5		 mov	 esp, ebp
  00037	5d		 pop	 ebp
  00038	c3		 ret	 0
_fprintf ENDP
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt\stdio.h
;	COMDAT __vfprintf_l
_TEXT	SEGMENT
__Stream$ = 8						; size = 4
__Format$ = 12						; size = 4
__Locale$ = 16						; size = 4
__ArgList$ = 20						; size = 4
__vfprintf_l PROC					; COMDAT

; 642  :     {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 643  :         return __stdio_common_vfprintf(_CRT_INTERNAL_LOCAL_PRINTF_OPTIONS, _Stream, _Format, _Locale, _ArgList);

  00009	8b 45 14	 mov	 eax, DWORD PTR __ArgList$[ebp]
  0000c	50		 push	 eax
  0000d	8b 4d 10	 mov	 ecx, DWORD PTR __Locale$[ebp]
  00010	51		 push	 ecx
  00011	8b 55 0c	 mov	 edx, DWORD PTR __Format$[ebp]
  00014	52		 push	 edx
  00015	8b 45 08	 mov	 eax, DWORD PTR __Stream$[ebp]
  00018	50		 push	 eax
  00019	e8 00 00 00 00	 call	 ___local_stdio_printf_options
  0001e	8b 48 04	 mov	 ecx, DWORD PTR [eax+4]
  00021	51		 push	 ecx
  00022	8b 10		 mov	 edx, DWORD PTR [eax]
  00024	52		 push	 edx
  00025	e8 00 00 00 00	 call	 ___stdio_common_vfprintf
  0002a	83 c4 18	 add	 esp, 24			; 00000018H

; 644  :     }

  0002d	5f		 pop	 edi
  0002e	5e		 pop	 esi
  0002f	5b		 pop	 ebx
  00030	8b e5		 mov	 esp, ebp
  00032	5d		 pop	 ebp
  00033	c3		 ret	 0
__vfprintf_l ENDP
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt\corecrt_stdio_config.h
;	COMDAT ___local_stdio_printf_options
_TEXT	SEGMENT
___local_stdio_printf_options PROC			; COMDAT

; 86   :     {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 87   :         static unsigned __int64 _OptionsStorage;
; 88   :         return &_OptionsStorage;

  00009	b8 00 00 00 00	 mov	 eax, OFFSET ?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA ; `__local_stdio_printf_options'::`2'::_OptionsStorage

; 89   :     }

  0000e	5f		 pop	 edi
  0000f	5e		 pop	 esi
  00010	5b		 pop	 ebx
  00011	8b e5		 mov	 esp, ebp
  00013	5d		 pop	 ebp
  00014	c3		 ret	 0
___local_stdio_printf_options ENDP
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File C:\Mu Online\Mu-GS-Webzen-MC-10093\GameServer\PShop.cpp
;	COMDAT ?__empty_global_delete@@YAXPAXI@Z
_TEXT	SEGMENT
___formal$ = 8						; size = 4
___formal$ = 12						; size = 4
?__empty_global_delete@@YAXPAXI@Z PROC			; __empty_global_delete, COMDAT

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi
  00009	5f		 pop	 edi
  0000a	5e		 pop	 esi
  0000b	5b		 pop	 ebx
  0000c	8b e5		 mov	 esp, ebp
  0000e	5d		 pop	 ebp
  0000f	c3		 ret	 0
?__empty_global_delete@@YAXPAXI@Z ENDP			; __empty_global_delete
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File C:\Mu Online\Mu-GS-Webzen-MC-10093\GameServer\PShop.cpp
;	COMDAT ?__empty_global_delete@@YAXPAX@Z
_TEXT	SEGMENT
___formal$ = 8						; size = 4
?__empty_global_delete@@YAXPAX@Z PROC			; __empty_global_delete, COMDAT

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi
  00009	5f		 pop	 edi
  0000a	5e		 pop	 esi
  0000b	5b		 pop	 ebx
  0000c	8b e5		 mov	 esp, ebp
  0000e	5d		 pop	 ebp
  0000f	c3		 ret	 0
?__empty_global_delete@@YAXPAX@Z ENDP			; __empty_global_delete
_TEXT	ENDS
END
